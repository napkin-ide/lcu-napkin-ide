<ng-container *ngIf="!State.Loading">
  <section
    class="welcome"
    *ngIf="State.UserSetupStep == UserSetupStepTypes.Welcome"
  >
    <div class="spread" fxLayout="row" fxLayout="center center">
      <div fxFlex="auto"></div>

      <div fxFlex="40%" fxFlex.lt-md="60%" fxFlex.lt-sm="90%">
        <h2>Welcome to Fathym<br />Fathym It. Build It.</h2>

        <p>
          Being a developer is more than just the languages you know, the code
          you right, the IDEs you use, the cloud you choose, and the tools you
          prefer; its the way you use them to create solutions to real problems.
        </p>

        <p>
          Use the technology you prefer with Fathym to deliver quality solutions
          to your customers.
        </p>

        <button
          mat-raised-button
          color="accent"
          class="mat-full-width"
          (click)="SetUserSetupStep(UserSetupStepTypes.Setup)"
        >
          Start Setup
        </button>
      </div>

      <div fxFlex="auto"></div>
    </div>
  </section>

  <section
    class="setup"
    *ngIf="State.UserSetupStep == UserSetupStepTypes.Setup"
  >
    <div fxLayout="row wrap" fxLayout="center center">
      <div fxFlex="40%" fxFlex.lt-sm="80%">
        <div class="spread text-center">
          <ng-container *ngIf="stepper.selectedIndex == 0">
            <h2 class="h2 paragraph-title-bold margin-bottom-3 margin-top-3">
              Organization Details
            </h2>

            <h3 class="mat-subheading-2">
              Fathym’s low-code framework is designed for organizations of any
              size. It's built to give developers the freedom and best practice
              workflows to rapidly create IoT and data-driven applications that
              are agnostic to tools, platforms and clouds.
            </h3>
          </ng-container>

          <ng-container *ngIf="stepper.selectedIndex == 1">
            <h2 class="h2 paragraph-title-bold margin-bottom-3 margin-top-3">
              Set Up Organization Infrastructure
            </h2>

            <h3 class="mat-subheading-2">
              You will need to have a Microsoft Azure account to get started.
              Create a new account or use an existing account.
            </h3>

            <div class="btn-split">
              <a
                mat-raised-button
                href="https://azure.microsoft.com/free/"
                color="primary"
                class="mat-full-width"
                target="_blank"
              >
                <img class="azure-logo" src="assets/img/Azure-logo.png" />

                Create &nbsp; a &nbsp; Free &nbsp; Azure &nbsp; Account
              </a>
            </div>

            <h3 class="mat-subheading-2" style="margin-top:15px;">
              Fathym needs access to your Azure subscription to help you manage
              your infrastructure.
            </h3>

            <div class="btn-split">
              <a
                mat-raised-button
                href="https://docs.microsoft.com/en-us/azure/active-directory/develop/howto-create-service-principal-portal#get-values-for-signing-in."
                color="primary"
                class="mat-full-width"
                target="_blank"
              >
                <mat-icon>settings</mat-icon>

                Locate Your Configuration Information
              </a>
            </div>

            <div class="spread">
              <h4 class="mat-subheading-1">
                Additional infrastructure options coming soon!
              </h4>
            </div>
          </ng-container>

          <ng-container *ngIf="stepper.selectedIndex == 2">
            <h2 class="h2 paragraph-title-bold margin-bottom-3 margin-top-3">
              Select Product Plan
            </h2>

            <div class="spread">
              <h3 class="mat-subheading-2">
                Select the product plan that meets your needs.
              </h3>
            </div>

            <div class="spread">
              <h3 class="mat-subheading-2">
                Provide billing details so we can charge you post trial (cancel
                anytime).
              </h3>
            </div>
          </ng-container>

          <ng-container *ngIf="stepper.selectedIndex == 3">
            Review dets
          </ng-container>
        </div>
      </div>

      <div fxFlex="60%" fxFlex.lt-sm="80%">
        <mat-horizontal-stepper
          [linear]="true"
          #stepper
          (selectionChange)="StepperChanged($event)"
        >
          <mat-step [stepControl]="DetailsForm">
            <form [formGroup]="DetailsForm">
              <ng-template matStepLabel>Organization</ng-template>

              <mat-form-field class="mat-full-width">
                <input
                  matInput
                  placeholder="Organization Name"
                  formControlName="orgDetailName"
                  required
                />

                <mat-icon
                  matSuffix
                  matTooltip="Enter a unique name for your new organization"
                  matTooltipClass="tooltip-background"
                  >help_outline</mat-icon
                >
              </mat-form-field>

              <mat-form-field class="mat-full-width">
                <textarea
                  matInput
                  placeholder="Description"
                  formControlName="orgDetailDesc"
                  required
                ></textarea>

                <mat-icon
                  matSuffix
                  matTooltip="Enter a useful description for your new organization"
                  matTooltipClass="tooltip-background"
                  >help_outline</mat-icon
                >
              </mat-form-field>

              <mat-form-field class="mat-full-width">
                <input
                  matInput
                  placeholder="Organization Lookup"
                  formControlName="orgDetailLookup"
                  required
                />

                <mat-icon
                  matSuffix
                  matTooltip="Enter a valid organization lookup (lowercase alpha characters and '-' accepted)"
                  matTooltipClass="tooltip-background"
                >
                  help_outline
                </mat-icon>
              </mat-form-field>

              <div>
                <button
                  mat-raised-button
                  color="accent"
                  class="mat-full-width"
                  [disabled]="!DetailsForm.valid"
                  matStepperNext
                >
                  Next
                </button>

                <button
                  mat-button
                  class="mat-full-width"
                  color="warn"
                  (click)="SetUserSetupStep(UserSetupStepTypes.Welcome)"
                >
                  Back
                </button>
              </div>
            </form>
          </mat-step>

          <mat-step [stepControl]="InfraForm">
            <form [formGroup]="InfraForm">
              <ng-template matStepLabel>Infrastructure</ng-template>

              <mat-form-field class="mat-full-width">
                <div fxLayout="row" fxLayoutGap="10px">
                  <mat-icon
                    *ngIf="
                      OrgInfraAzureAppAppId.value.length > 0 &&
                      !OrgInfraAzureAppAppId.hasError('pattern')
                    "
                    class="success"
                    >check_circle</mat-icon
                  >
                  <input
                    formControlName="azureAppId"
                    matInput
                    placeholder="Azure App ID"
                    [type]="HideAppId ? 'password' : 'text'"
                    required
                    autocomplete="new-password"
                  />
                </div>
                <mat-error *ngIf="OrgInfraAzureAppAppId.hasError('pattern')">
                  {{ GuidErrorMessage }}
                </mat-error>
                <mat-icon
                  matBadgePosition="below after"
                  matBadgeColor="primary"
                  matBadgeOverlap="false"
                  color="warn"
                  matSuffix
                  (click)="HideAppId = !HideAppId"
                  class="cursor-pointer"
                  >{{ HideAppId ? "visibility_off" : "visibility" }}
                </mat-icon>
                <mat-icon
                  matSuffix
                  (click)="OpenHelpPdf()"
                  matTooltip="Obtain this value from the App Registration in Azure’s Active Directory. Click for more detailed instructions."
                  matTooltipClass="tooltip-background"
                  >help_outline</mat-icon
                >
                <!-- matBadge="{{OrgInfraAzureAppAppId.value.length}}"  -->
                <mat-hint>Guid Value</mat-hint>
              </mat-form-field>

              <mat-form-field class="mat-full-width margin-top-4">
                <div fxLayout="row" fxLayoutGap="10px">
                  <mat-icon
                    *ngIf="
                      OrgInfraAzureTenatId.value.length > 0 &&
                      !OrgInfraAzureTenatId.hasError('pattern')
                    "
                    class="success"
                    >check_circle</mat-icon
                  >
                  <input
                    formControlName="azureTenantId"
                    matInput
                    placeholder="Azure Tenant (Directory) ID"
                    [type]="HideTenantId ? 'password' : 'text'"
                    required
                    autocomplete="new-password"
                  />
                </div>
                <mat-error *ngIf="OrgInfraAzureTenatId.hasError('pattern')">
                  {{ GuidErrorMessage }}
                </mat-error>
                <mat-icon
                  matBadgePosition="below after"
                  matBadgeColor="primary"
                  matBadgeOverlap="false"
                  color="warn"
                  matSuffix
                  (click)="HideTenantId = !HideTenantId"
                  class="cursor-pointer"
                  >{{ HideTenantId ? "visibility_off" : "visibility" }}
                </mat-icon>
                <mat-icon
                  matSuffix
                  (click)="OpenHelpPdf()"
                  matTooltip="Obtain this value from the App Registration in Azure’s Active Directory. Click for more detailed instructions."
                  matTooltipClass="tooltip-background"
                  >help_outline</mat-icon
                >
                <!-- matBadge="{{OrgInfraAzureTenatId.value.length}}"  -->
                <mat-hint>Guid Value</mat-hint>
              </mat-form-field>

              <mat-form-field class="mat-full-width margin-top-4">
                <div fxLayout="row" fxLayoutGap="10px">
                  <mat-icon
                    *ngIf="
                      OrgInfraAzureSubId.value.length > 0 &&
                      !OrgInfraAzureSubId.hasError('pattern')
                    "
                    class="success"
                    >check_circle</mat-icon
                  >
                  <input
                    formControlName="azureSubId"
                    matInput
                    placeholder="Azure Subscription ID"
                    [type]="HideSubId ? 'password' : 'text'"
                    required
                    autocomplete="new-password"
                  />
                </div>
                <mat-error *ngIf="OrgInfraAzureSubId.hasError('pattern')">
                  {{ GuidErrorMessage }}
                </mat-error>
                <mat-icon
                  matBadgePosition="below after"
                  matBadgeColor="primary"
                  matBadgeOverlap="false"
                  color="warn"
                  matSuffix
                  (click)="HideSubId = !HideSubId"
                  class="cursor-pointer"
                  >{{ HideSubId ? "visibility_off" : "visibility" }}
                </mat-icon>
                <mat-icon
                  matSuffix
                  (click)="OpenHelpPdf()"
                  matTooltip="Obtain this value from the App Registration in Azure’s Active Directory. Click for more detailed instructions."
                  matTooltipClass="tooltip-background"
                  >help_outline</mat-icon
                >
                <!-- matBadge="{{OrgInfraAzureSubId.value.length}}"  -->
                <mat-hint>Guid Value</mat-hint>
              </mat-form-field>

              <mat-form-field class="mat-full-width margin-top-4">
                <div fxLayout="row" fxLayoutGap="10px">
                  <mat-icon
                    *ngIf="
                      OrgInfraAzureAppAuthKey.value.length > 0 &&
                      !OrgInfraAzureAppAuthKey.hasError('required')
                    "
                    class="success"
                    >check_circle</mat-icon
                  >
                  <input
                    formControlName="azureAppAuthKey"
                    matInput
                    placeholder="Azure App Auth key"
                    [type]="HideAuthKey ? 'password' : 'text'"
                    required
                    autocomplete="new-password"
                  />
                </div>
                <mat-error *ngIf="OrgInfraAzureAppAuthKey.hasError">
                  Value is required
                </mat-error>
                <mat-icon
                  matBadgePosition="below after"
                  matBadgeColor="primary"
                  matBadgeOverlap="false"
                  color="warn"
                  matSuffix
                  (click)="HideAuthKey = !HideAuthKey"
                  class="cursor-pointer"
                  >{{ HideAuthKey ? "visibility_off" : "visibility" }}
                </mat-icon>
                <mat-icon
                  matSuffix
                  (click)="OpenHelpPdf()"
                  matTooltip=" Obtain this value from Azure’s Certificates and Secrets page. Click for more detailed instructions."
                  matTooltipClass="tooltip-background"
                  >help_outline</mat-icon
                >
                <!-- matBadge="{{OrgInfraAzureAppAuthKey.value.length}}"  -->
                <!-- <mat-hint>32 Character Limit</mat-hint> -->
              </mat-form-field>

              <div>
                <button
                  matTooltip="Your best practices IoT cloud infrastructure is being set up. If you were doing this from scratch, it would take several days, but with Fathym it will only take up to 15 minutes."
                  matTooltipClass="tooltip-background"
                  mat-raised-button
                  color="accent"
                  class="mat-full-width"
                  matStepperNext
                  [disabled]="!InfraForm.valid"
                >
                  Next
                </button>

                <button
                  mat-button
                  class="mat-full-width"
                  color="warn"
                  matStepperPrevious
                >
                  Back
                </button>
              </div>
            </form>
          </mat-step>

          <mat-step [stepControl]="BillingForm">
            <form
              action="/charge"
              method="post"
              id="payment-form"
              [formGroup]="BillingForm"
              (ngSubmit)="SubmitBilling($event)"
            >
              <ng-template matStepLabel>Product Plan</ng-template>

              <div
                class="product-plans form-row"
                fxLayout="row wrap"
                fxLayout="center center"
              >
                <mat-radio-group
                  aria-labelledby="example-radio-group-label"
                  [(ngModel)]="favoriteSeason"
                >
                  <div fxFlex="25%">
                    <mat-card class="spread">
                      <mat-radio-button
                        class="example-radio-button"
                        [value]="season"
                      >
                        Explorer
                      </mat-radio-button>
                    </mat-card>
                  </div>

                  <div fxFlex="25%">
                    <mat-card class="spread">
                      <mat-radio-button
                        class="example-radio-button"
                        [value]="season"
                      >
                        Explorer
                      </mat-radio-button>
                    </mat-card>
                  </div>
                </mat-radio-group>
              </div>

              <div class="form-row">
                <label for="card-element" class="spread"
                  >Enter Payment Details</label
                >

                <div id="card-element" class="spread"></div>

                <div
                  id="card-errors"
                  role="alert"
                  class="spread"
                  *ngIf="StripeError"
                >
                  {{ StripeError }}
                </div>
              </div>

              <div class="spread">
                <button mat-raised-button color="primary">
                  Add payment source
                </button>
              </div>
            </form>
          </mat-step>

          <mat-step>
            <ng-template matStepLabel>Review</ng-template>
            <p>You are now done.</p>
            <div>
              <button mat-button matStepperPrevious>Back</button>

              <button mat-button (click)="stepper.reset()">Reset</button>
            </div>
          </mat-step>
        </mat-horizontal-stepper>
      </div>
    </div>
  </section>
</ng-container>

<div *ngIf="State.Loading">
  <p style="text-align: center;">
    Behind the scenes Thinky is working hard to set up your Low Code Unit
  </p>

  <!-- <p style="text-align: center;"></p> -->

  <div fxLayout="row" fxLayoutAlign="center center" class="spinner-container">
    <mat-spinner diameter="75"></mat-spinner>
    <div class="spinner-logo" logo-alt="Fathym Logo"></div>
  </div>
</div>

<!-- <button mat-raised-button color="primary" (click)="SetUserDetails()">Set User Details</button> -->
